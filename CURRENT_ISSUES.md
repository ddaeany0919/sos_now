# í˜„ì¬ í•´ê²° ì¤‘ì¸ ë¬¸ì œ (2026-01-22)

## ğŸ› ë¯¸í•´ê²° ë¬¸ì œ

### 1. ì§€ë„ ì´ˆê¸° ë¡œë”© ë¬¸ì œ âŒ
**ì¦ìƒ**:
- í˜ì´ì§€ ì ‘ì† ì‹œ "LOADING MAP..." ë¬´í•œ ë¡œë”©
- ìƒˆë¡œê³ ì¹¨(F5)í•´ì•¼ë§Œ ì§€ë„ê°€ í‘œì‹œë¨

**ì›ì¸ ì¶”ì •**:
- `RawSosMap.tsx`ì˜ useEffectê°€ ì œëŒ€ë¡œ íŠ¸ë¦¬ê±°ë˜ì§€ ì•ŠìŒ
- Naver Maps API ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© íƒ€ì´ë° ì´ìŠˆ
- `isMapLoaded` ìƒíƒœê°€ ì œëŒ€ë¡œ ì—…ë°ì´íŠ¸ ì•ˆ ë¨

**ê´€ë ¨ íŒŒì¼**:
- `src/components/RawSosMap.tsx` (line 240-270)

---

### 2. ë¦¬ìŠ¤íŠ¸ ë·° ì¹´í…Œê³ ë¦¬ ì „í™˜ ì•ˆ ë¨ âŒ
**ì¦ìƒ**:
- ì§€ë„ ë·°ì—ì„œ "ì‘ê¸‰ì‹¤" íƒ­ í´ë¦­
- ë¦¬ìŠ¤íŠ¸ ë·°ë¡œ ì „í™˜
- "ì•½êµ­", "AED" ë“± ë‹¤ë¥¸ íƒ­ í´ë¦­
- ì—¬ì „íˆ ì‘ê¸‰ì‹¤ ëª©ë¡ë§Œ í‘œì‹œë¨

**ì›ì¸**:
- `RawSosMap.tsx`ê°€ `viewMode === 'map'`ì¼ ë•Œë§Œ `setItems(data)` í˜¸ì¶œ
- ë¦¬ìŠ¤íŠ¸ ë·°ì—ì„œëŠ” ì „ì—­ `items` ìƒíƒœê°€ ì—…ë°ì´íŠ¸ ì•ˆ ë¨
- `page.tsx`ì˜ `filteredItems`ê°€ ì˜¤ë˜ëœ `items`ë¥¼ ì°¸ì¡°

**ê´€ë ¨ ì½”ë“œ**:
```typescript
// src/components/RawSosMap.tsx (line 104-107)
if (viewMode === 'map') {
    setItems(data);  // ë¦¬ìŠ¤íŠ¸ ë·°ì—ì„œëŠ” ì‹¤í–‰ ì•ˆ ë¨!
}
```

---

## âœ… í•´ê²°ëœ ë¬¸ì œ

### 1. ì˜ì—…ì‹œê°„ ì •ë³´ í‘œì‹œ âœ…
- 3ìë¦¬ ì‹œê°„ í˜•ì‹("900") ì§€ì› ì¶”ê°€
- 24:00 (ìì •) íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ ì²˜ë¦¬
- `formatTime()`, `timeToMinutes()` í•¨ìˆ˜ ìˆ˜ì •

### 2. ê²€ìƒ‰ ìë™ì™„ì„± UI âœ…
- ì§€ë„ ë·°ì—ì„œë§Œ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ í‘œì‹œ
- z-index ì¡°ì •ìœ¼ë¡œ ê²¹ì¹¨ ë°©ì§€
- ìƒìœ„ 5ê°œ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°

### 3. ë¦¬ìŠ¤íŠ¸ ë·° UI ê²¹ì¹¨ âœ…
- padding-top: 40 â†’ 56ìœ¼ë¡œ ì¦ê°€
- í—¤ë”ì™€ ëª©ë¡ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ìˆ˜ì •

---

## ğŸ”§ ì‹œë„í•œ í•´ê²° ë°©ë²•

### ë¬´í•œ ë¡œë”© í•´ê²° ì‹œë„ (ë¶€ë¶„ ì„±ê³µ)
1. `searchQuery`, `filterOpenNow`ë¥¼ useEffect ì˜ì¡´ì„±ì—ì„œ ì œê±°
2. ë³„ë„ì˜ useEffectë¡œ ê²€ìƒ‰/í•„í„° ë³€ê²½ ì‹œ ë§ˆì»¤ë§Œ ì—…ë°ì´íŠ¸
3. ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œì—ë§Œ `fetchData()` í˜¸ì¶œ

**ê²°ê³¼**: ë¬´í•œ ë¡œë”©ì€ ì¤„ì—ˆì§€ë§Œ ì—¬ì „íˆ ì´ˆê¸° ë¡œë”© ë¬¸ì œ ì¡´ì¬

---

## ğŸ’¡ ë‹¤ìŒ ì‹œë„ ë°©ë²• ì œì•ˆ

### ë¬¸ì œ 1: ì§€ë„ ì´ˆê¸° ë¡œë”©
**ì˜µì…˜ A**: Naver Maps Script ë¡œë”© í™•ì¸
```typescript
const checkNaverMaps = () => {
  if (window.naver?.maps) {
    initializeMap();
  } else {
    setTimeout(checkNaverMaps, 100);
  }
};
```

**ì˜µì…˜ B**: Next.js Scriptì˜ `onLoad` í™œìš©
```typescript
<Script onLoad={() => setIsScriptLoaded(true)} />
```

### ë¬¸ì œ 2: ë¦¬ìŠ¤íŠ¸ ë·° ì¹´í…Œê³ ë¦¬ ì „í™˜
**ì˜µì…˜ A**: `page.tsx`ì—ì„œ ì§ì ‘ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
- ë¦¬ìŠ¤íŠ¸ ë·°ì¼ ë•ŒëŠ” `RawSosMap`ì„ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
- `page.tsx`ì—ì„œ ì§ì ‘ Supabase ë°ì´í„° fetch

**ì˜µì…˜ B**: `items`ë¥¼ `viewMode`ì™€ ë¬´ê´€í•˜ê²Œ í•­ìƒ ì—…ë°ì´íŠ¸
```typescript
// viewMode ì¡°ê±´ ì œê±°
setItems(data);
```

---

## ğŸ“ ì£¼ìš” íŒŒì¼ êµ¬ì¡°

```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ map/
â”‚       â””â”€â”€ page.tsx           # ë©”ì¸ ì§€ë„/ë¦¬ìŠ¤íŠ¸ ë·° í˜ì´ì§€
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ RawSosMap.tsx          # ì§€ë„ ì»´í¬ë„ŒíŠ¸ (ë¬¸ì œ ë°œìƒ ì§€ì )
â”‚   â””â”€â”€ SosBottomSheet.tsx     # ìƒì„¸ ì •ë³´ ë°”í…€ì‹œíŠ¸
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ businessHours.ts       # ì˜ì—…ì‹œê°„ ê³„ì‚° (ìˆ˜ì •ì™„ë£Œ)
â”‚   â””â”€â”€ distance.ts            # ê±°ë¦¬ ê³„ì‚°
â””â”€â”€ store/
    â””â”€â”€ useSosStore.ts         # ì „ì—­ ìƒíƒœ ê´€ë¦¬ (Zustand)
```

---

## ğŸ” í•µì‹¬ ìƒíƒœ ê´€ë¦¬

### Zustand Store (`useSosStore`)
```typescript
{
  selectedCategory: 'EMERGENCY' | 'PHARMACY' | 'ANIMAL_HOSPITAL' | 'AED' | 'FAVORITES',
  items: any[],              // í˜„ì¬ ì¹´í…Œê³ ë¦¬ì˜ ì „ì²´ ë°ì´í„°
  searchQuery: string,        // ê²€ìƒ‰ì–´
  filterOpenNow: boolean,     // ì˜ì—…ì¤‘ í•„í„°
  // ...
}
```

### ë°ì´í„° íë¦„
1. **ì¹´í…Œê³ ë¦¬ ë³€ê²½** â†’ `RawSosMap.fetchData()` â†’ Supabase ì¡°íšŒ â†’ `setItems(data)`
2. **ê²€ìƒ‰/í•„í„° ë³€ê²½** â†’ `page.tsx`ì—ì„œ `filteredItems` ê³„ì‚°
3. **ì§€ë„ ë§ˆì»¤** â†’ `RawSosMap`ì—ì„œ `updateMarkers(filtered)`

---

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í˜ì´ì§€ ì²« ì ‘ì† ì‹œ ì§€ë„ ë°”ë¡œ ë¡œë“œ
- [ ] ì¹´í…Œê³ ë¦¬ ì „í™˜ ì‹œ ì¦‰ì‹œ ë°˜ì˜ (ì§€ë„ ë·°)
- [ ] ì¹´í…Œê³ ë¦¬ ì „í™˜ ì‹œ ì¦‰ì‹œ ë°˜ì˜ (ë¦¬ìŠ¤íŠ¸ ë·°)
- [ ] ê²€ìƒ‰ ì‹œ ë§ˆì»¤ í•„í„°ë§ (ì§€ë„ ë·°)
- [ ] ê²€ìƒ‰ ì‹œ ëª©ë¡ í•„í„°ë§ (ë¦¬ìŠ¤íŠ¸ ë·°)
- [ ] ê²€ìƒ‰ ìë™ì™„ì„± í‘œì‹œ (ì§€ë„ ë·°ë§Œ)
- [ ] ì˜ì—…ì¤‘ í•„í„° ì‘ë™ (ì•½êµ­/ë™ë¬¼ë³‘ì›)
- [ ] ì˜ì—…ì‹œê°„ ì •ë³´ í‘œì‹œ (ì•½êµ­ ìƒì„¸)
- [ ] ì§€ë„/ë¦¬ìŠ¤íŠ¸ ë·° ì „í™˜ ì •ìƒ ì‘ë™
- [ ] ë¬´í•œ ë¡œë”© ì—†ìŒ

---

## ğŸ“ ì°¸ê³  ì •ë³´

**ê°œë°œ ì„œë²„**: `npm run dev` (localhost:3000)
**ë°°í¬ URL**: https://sos-now-one.vercel.app
**Git ë¸Œëœì¹˜**: main
**ë§ˆì§€ë§‰ ì»¤ë°‹**: (ì‘ì„± ì˜ˆì •)
