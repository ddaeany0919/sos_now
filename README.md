# 🚑 SOS-NOW (실시간 응급 지도)

전국 응급실, 심야 약국, 24시 동물병원의 실시간 상태를 한눈에 확인하는 서비스입니다. 공식 앱의 불편함을 해결하고, 1분 1초가 급한 순간에 가장 빠르고 정확한 정보를 제공합니다.
# 🚑 SOS-NOW (실시간 응급 의료 정보 플랫폼)

SOS-NOW는 1분 1초가 급한 상황에서 당신 주변의 가장 가까운 응급실, 약국, 동물병원, AED 위치를 실시간으로 찾아주는 프리미엄 의료 정보 서비스입니다.

## ✨ 현재 진행 상황 (Status)

### 🟢 Phase 1: 기반 구축 및 UI 개편 (완료)
- [O] **프리미엄 UI/UX 개편**: 글래스모피즘 및 최신 트렌드 반영
- [O] **네이버 지도 연동**: 커스텀 마커 및 실시간 위치 추적
- [O] **데이터 엔진 구축**: NEMC API 연동 및 Supabase 실시간 동기화
- [O] **카테고리 확장**: 약국, 동물병원, AED 데이터 구조 설계
- [O] **핵심 기능 구현**: 실시간 검색, 즐겨찾기, 리스트 뷰 토글
- [O] **런타임 오류 해결**: 네이버 지도 로딩 지연 및 빌드 에러 수정

### 🔵 Phase 2: UI 디테일 및 사용성 개선 (완료)
- [O] **정보 팝업(바텀시트) 최적화**:
    - 화면 중앙 배치 및 스케일 애니메이션 적용
    - 배경 투명도 조절(`bg-white/60`) 및 강력한 블러 효과(`backdrop-blur-3xl`)로 지도 가독성 유지
    - 팝업 외부(배경/지도) 클릭 시 즉시 닫기 기능 구현
- [O] **지도 컨트롤 단순화**: 줌 컨트롤에서 불필요한 텍스트 제거 및 스타일 최적화(`SMALL` 스타일)
- [O] **인증 시스템 안정화**: 중복 스크립트 제거 및 `ncpKeyId` 방식 완전 정착

---

## 🚀 향후 로드맵 (Phase 3 예정)

사용자 경험을 한 단계 더 높이기 위해 다음 기능들을 순차적으로 도입할 예정입니다.

### 🟡 Phase 3: 기능 고도화 및 데이터 확장 (진행 중)
- [O] **마커 클러스터링**: 대량의 데이터를 효율적으로 보여주는 클러스터링 도입 완료
- [O] **내비게이션 연동**: 네이버 지도 앱/웹 딥링크 연동 완료
- [O] **영업 중 필터**: 현재 시간 기준 운영 시설 필터링 로직 구현 완료
- [ ] **실시간 공공 데이터 연동**: 약국, AED 등 실제 API 연동 (진행 중)
- [ ] **상세 검색 및 필터**: 병원명, 지역명, 진료 과목별 필터링 기능
- [ ] **사용자 제보 시스템**: 데이터 정확도 향상을 위한 리포트 기능

### 🔴 Phase 4: 플랫폼 확장
- [ ] **PWA 지원**: 오프라인 접근성 및 푸시 알림 기능
- [ ] **모바일 앱**: React Native/Expo를 이용한 네이티브 앱 출시

---

## 🛠 기술 스택
- **Frontend**: Next.js 15 (App Router), TypeScript, Tailwind CSS 4
- **State Management**: Zustand
- **Backend**: Supabase (PostgreSQL, PostGIS)
- **Maps**: Naver Maps API
- **Data**: 국립중앙의료원(NEMC) 공공 API

## 🚀 빠른 시작 가이드 (Quick Start)

### 1. 데이터베이스 설정 (Supabase)
`sos_now_schema.sql` 파일의 내용을 복사하여 Supabase SQL Editor에서 실행하세요.
- PostGIS 확장 및 위치 자동 업데이트 트리거가 포함되어 있습니다.

### 2. 환경 변수 확인 (`.env.local`)
프로젝트 루트의 `.env.local` 파일에 아래 정보가 정확히 입력되어 있는지 확인하세요.
- `NEMC_SERVICE_KEY`: (사용자 키 적용됨 ✅)
- `NEXT_PUBLIC_NAVER_MAP_CLIENT_ID`: 네이버 지도 ID (`1wy9kuh1au` ✅)
- `NEXT_PUBLIC_SUPABASE_URL`: Supabase API URL ✅
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Supabase Anon Key ✅

### 3. 데이터 동기화 (Data Sync)
앱 실행 후 아래 주소로 접속하여 **[🔄 공공 API 데이터 동기화]** 버튼을 클릭하세요.
- 주소: `http://localhost:3000/sos-now`
- 이 작업을 통해 전국 응급실 데이터가 사용자님의 DB로 수집됩니다.

---

## 💡 주요 해결 과제 (Troubleshooting)

### 🗺️ 네이버 지도 인증 실패 (Authentication Failed) 해결
개발 과정에서 Client ID와 서비스 URL이 정확함에도 불구하고 `Authentication Failed (Error 200)`가 발생하는 문제가 있었습니다. 이를 다음과 같이 해결했습니다.

1.  **매개변수 명칭 변경**: 네이버 API 호출 시 `ncpClientId` 대신 **`ncpKeyId`**를 사용하여 인증 성공률을 높였습니다.
2.  **스크립트 로딩 전략 최적화**: `layout.tsx`의 정적 로딩 방식에서 컴포넌트 단위의 **`next/script (strategy="afterInteractive")`** 방식으로 전환하여, 페이지 로드 후 안전하게 인증이 이루어지도록 개선했습니다.
3.  **순차적 종속성 해결**: 메인 지도 스크립트가 로드된 직후에만 클러스터링 스크립트를 동적으로 삽입하여 스크립트 간 충돌을 방지했습니다.
4.  **중복 스크립트 제거**: `layout.tsx`에 남아있던 구형 스크립트 태그가 최신 스크립트와 충돌하는 문제를 발견하여 제거함으로써 인증 오류를 완전히 해결했습니다.

---
*본 프로젝트는 사용자님의 요청에 따라 독립적인 폴더(`sos_now`)에서 관리됩니다.*
